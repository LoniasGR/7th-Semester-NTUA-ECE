IN 10H

MVI B,01H ;B and C are 0032H = 50D
MVI C,F4H ;

MVI D,00H ;D is the posiotion of the train on the LEDs

MVI E,00H ;E is the direction, if 0 means move left, if 1 or 3 don't move,
	   ; if 2 move right
MVI A,0DH
SIM
EI

MAIN:
LDA 2000H
ANI 01H
CPI 01H
JNZ MAIN
JMP CHECK_EDGES

LED_ON:
MOV A,D
CMA
STA 3000H
DI
CALL DELB
EI
JMP MAIN

DIRECTION:
MOV A,D
CPI 00H
JZ FIRST_TIME
MOV A,E
CPI 00H
JZ LEFT
CPI 01H
JZ MAIN
CPI 02H
JZ RIGHT
CPI 03H
JZ LED_ON

FIRST_TIME:
INR D
JMP LED_ON

LEFT:
MOV A,D
RLC 
MOV D,A
JMP LED_ON

RIGHT:
MOV A,D
RRC
MOV D,A
JMP LED_ON

CHECK_EDGES:
MOV A,D
CPI 80H
JNZ CHECK_EDGES_2
MOV A,E
CPI 00H
JZ MAIN
JMP DIRECTION
 	
CHECK_EDGES_2:
MOV A,D
CPI 01H
JNZ DIRECTION
MOV A,E
CPI 02H
JZ MAIN
JMP DIRECTION

HLT

INTR_ROUTINE:
DI
PUSH PSW
PUSH B

ROUTINE_1:
LDA 2000H
ANI 01H
CPI 01H
JNZ ROUTINE_END

RIM		;
ANI 20H	;
CPI 20H	;
JZ ROUTINE_1	;
MVI C,32H	;Flowchart no.1 from 8085 from laboratory notes
MVI B,00H	;page 60
CALL DELB	;
RIM		;
ANI 20H	;
CPI 20H	;
JZ ROUTINE_1	;

INR E
MOV A,E
CPI 04H
JZ RESET_E
JMP ROUTINE_END

RESET_E:
MVI E,00H
JMP ROUTINE_END

ROUTINE_END:
POP B
POP PSW
EI
RET


END